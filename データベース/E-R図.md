## E-R図の構成要素

- EはEntity,実体、RはRelationship,関係を指す。
- この二つの関係を表す図をE-R図と呼ぶ。
- E-R図は実体間の関係の意味を表現できる、さまざまなデータ構造を表現できる、関係モデルとの親和性が高いといった特徴がある。

#### 実体
実体は実世界を構成する要素である、実体はその性質を表す複数の属性を持っている（例えば顧客だと名前、電話番号がある）、それらの属性が具体的な値を持つとき（例えば名前と電話番号がわかる顧客レコード）それをインスタンスと呼ぶ。
実体の持つ属性の中に、インスタンスを識別には、識別子が必要となる。識別子はインスタンス間では一意である必要があるので、例えば顧客インスタンスを管理する場合は、顧客番号を振当てして管理する。この識別子は関係データベースの主キーとなる。

### リレーション
リレーションシップは実体間の業務ルールを基に発生した関係を指す。関係には1対1、1対多、多対多の違いがある。
![[Pasted image 20230814115009.png]]

### 多対多からの変換
多対多の関連は関連データベースに適してなく、実装が難しくなるので、多対多の関係を分解する必要がある。
手法は、多対多を1対多と多対1に分割すること。
例えば、顧客と商品は多対多の関係だが、間に注文というエンティティを追加し、顧客番号と商品番号で顧客番号と注文番号の1対多関係を作った後、複数の注文に対して一つの商品番号と紐付けすることで、多対1の関係を築くことができる。
このような手法を連関エンティティと呼ばれる。

### 弱エンティティと強エンティティ
関係データベース内1対多の関係では、1を外部キーとして持つ、その外部キーが主キーの一部となる場合は、このエンティティは1に依存することになる。
例えば上記顧客と商品の関係では、注文は顧客と商品の1をキーとして扱っているので、この二つのキーに依存することとなる。顧客と商品が存在しなければ注文も存在しないので、このような独立では存在しないエンティティを弱エンティティと呼ぶ、顧客や商品のように独立でも存在するエンティティを強エンティティと呼ぶ。
注文には、顧客番号や商品番号は主キーではなく、注文番号というキーが主キーとして付与されれば、独立して存在できる強エンティティとなる。

### 自己参照の1対多
![[Pasted image 20240221231311.png]]

![[Pasted image 20240221231341.png]]

部署の階層は木構造になっており，再帰リレーションシップで表現している。最上位は会社で，下に向かって本部，部，課などが配置されている。上位部署IDには，上位部署の部署IDを保持し，最上位である会社の上位部署IDにはNULLを設定する。

問題：表1のbとcは図1のどの属性になるか？
- 問題文の「部署の階層は木構造になっており」から、一つの上位部署に複数の下位部署が存在していることがわかる。
- 問題文の「上位部署IDには、上位部署の部署ID」から、このEーR関係は自己参照していると分かる。
- 通常では、木構造で一つの上位部署に対して複数の下位部署をもつことから、上位部署ID→部署IDと勘違いすることが多い。それが誤りの理由はまず：
	  1. 上位部署IDは主キーではなく、1対多の関係を形成することはできない（上位部署IDは部署テーブルでは、部署テーブルを自己参照している外部キーになる、外部キーが1対多関係の1になれないのは、システムの制約の他に、外部キーは親テーブルでは複数存在しているので、１と設定された場合、多側のレコードに対して唯一の1を代表できないからのは原因）
	  2. そして組織の構造から、上位部署ID→部署IDというのも誤っている、ここでは勘違いされやすいのは、上位部署IDという属性はあくまで、部署IDを参照するものであって、上位部署そのものではないことを理解しないといけない。一つの上位部署IDに対して複数の部署IDが存在していることは（SQLの規制上ではあり得ないだが）、組織の階層は木構造ではなく、逆木構造になっている（一つの下位部署に複数の上位部署が存在する）
- 部署ID→上位部署IDを理解するには、まず複数の部署エンティティを想像し、一つの上位部署IDを複数の下位部署のエンティティ中の上位部署IDが参照していることから、部署IDが1、上位部署IDが多と分かる。