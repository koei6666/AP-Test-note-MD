# 1.
![[Pasted image 20250318221045.png]]
![[Pasted image 20250318221110.png]]
MAIL FROM
SMTPでは送信者のメールアドレスをMAIL FROMコマンドで指定する、送信者がメールサーバに対して接続開始する時は`HELO mail@address.com`で自分のアドレスを提示する
[[SMTP Commands]]

# 2.
![[Pasted image 20250318222105.png]]
![[Pasted image 20250318222134.png]]
![[Pasted image 20250318222146.png]]
攻撃1:攻撃者のメールサーバからN社の取引先と偽装するメールアドレスのメールが送信されると言うことなので、検証する際では、取引先のメールサーバにもSPFを対応しなければいけない
外部DNSサーバが設定済みだが、これは取引先に関する検証になるので関係はない。
外部メールサーバでの対応は設定済みなので、問い合わせは実施する、ただ取引先のDNSサーバの設定も確認する必要があるので、効果があるかどうかは次の項目を見る
取引先のDNSサーバの設定は未設定なので、受信したメールサーバから問い合わせることはできるか、取引サーバ未設定のため検証はできず、攻撃1に対して効果はない。
取引先のメールサーバの対応も実施しないので、N社のメールアドレスの偽装に対しても効果がない
b: x c: x

次に、送信受信DNSサーバは設定されるが、両方のサーバではSPF実施しないので、2種の攻撃に対して効果がない：
d: x e: x

次にDNSサーバは設定されるが、メールサーバの対応はしない、取引先に関してはDNS設定しないが、メールサーバの対応はすると言う状況では、N社のメールアドレス偽称するメールは取引先で受信されたらDNSサーバに問い合わせし、SPFでメールアドレスの真偽が確認されるので攻撃2に対しては効果あり、ただ攻撃1に関しては、メールサーバからの問い合わせは実施しないので効果なし：
f: x g: o

最後は、取引先だけDNSとSPF対応をし、N社は何も対応しない場合では、N社のメールアドレスは検証されず、その上取引先のアドレスも検証しないので、攻撃2種に対して効果なし
h: x i: x

# 3.
![[Pasted image 20250318224119.png]]
![[Pasted image 20250318224136.png]]
SPFに登録する、n-sha.co.jpの権威メールサーバのIPアドレスがjになるので、
![[Pasted image 20250318224318.png]]
j= x1.y1.z1.1

# 4.
![[Pasted image 20250318224357.png]]
![[Pasted image 20250318224424.png]]
Envelope-FROMのメールアドレスを変えずに転送する場合では、そのアドレスのIPアドレスと転送するサーバのSPF IPアドレスと一致しない。
~~転送するサーバのSPFレコードとEnvelop-FromのメールアドレスのIPと一致しないため~~
DNSサーバに登録されているIPアドレスとSMTP接続元のIPアドレスと一致しないため

# 5.
![[Pasted image 20250318225404.png]]
![[Pasted image 20250318225422.png]]
メールの内容==およびヘッダー==が改竄されたかどうか

# 6.
![[Pasted image 20250318225549.png]]
![[Pasted image 20250318225621.png]]
![[Pasted image 20250318225657.png]]
k:配信エラーの通知はX社のメールサーバに届くとのことなので、N社のサブドメインのメールサーバを名前解決する際には、x社のメールアドレスを返さないといけないので、k= `mail.x-sha.co.jp.`
そして送信したメールが受信先でSPF検証通れるように、a社サブドメインのSPFでは配信サービスのx社のIPアドレスを登録すべき　l= x2.y2.z2.1

![[Pasted image 20250318230441.png]]
![[Pasted image 20250318230508.png]]
受信で検証失敗したメールは隔離されるので、m= `quarantine`
x社で配信するものでは、完全修飾ドメインでは異なるので、sで検証するとx社の配信メールが隔離される、そのため、組織ドメインのみ検証にすべき n= r
![[DMARC]]

# 7.
![[Pasted image 20250318231314.png]]
サブドメインの不正入手による詐称：
正規の取引先ドメインのサブドメインを攻撃者が入手することは、通常の状況下では現実的ではありません。以下にその理由を技術的に説明します:

1. 管理権限の問題：サブドメインは親ドメインの管理者によって制御されています。攻撃者がサブドメインを入手するためには、以下のいずれかが必要です:
    
    - ドメイン管理システムへの不正アクセス
    - DNS管理者アカウントの侵害
    - DNS設定を変更できる権限を持つシステムの侵害
2. セキュリティ対策：多くの組織では、以下のような保護措置を講じています:
    
    - DNSセキュリティ拡張(DNSSEC)の実装
    - DNS管理インターフェースへの多要素認証
    - DNSゾーン転送の制限
    - 権限委譲の厳格な管理
3. 検出の容易さ：正規ドメインのサブドメインが突然作成された場合、DNS変更監視ツールや異常検知システムによって検出される可能性が高くなります。
    

より現実的な攻撃ベクトルとしては、視覚的に類似したドメイン(typosquatting)や国際化ドメイン名(IDN)を使用した同形異義文字攻撃が一般的です。これらの方法では、元のドメインに対する管理権限を必要とせず、独自のドメインを登録するだけで実行可能です。

攻撃者が取引先のドメインを詐称し、SPF/DKIM/DMARCをバイパスする方法は、N社の取引先になりすまして正規の取引先とは異なるドメインから偽装メールを送信することです。取引先の正確な名前を使用しつつ、視覚的に類似したドメイン（同形異義文字攻撃）を用いれば、ドメイン認証を回避しながらも受信者を欺くことが可能です。