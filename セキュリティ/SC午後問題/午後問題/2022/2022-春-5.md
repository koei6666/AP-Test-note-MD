# 1.
![[Pasted image 20250209210743.png]]
![[Pasted image 20250209210819.png]]
![[Webシステムの三層構造#CDN]]
## キャッシュサーバ：
キャッシュサーバは、CDNの中、コンテンツのキャッシュバージョンを補完する分散型のサーバである。
キャッシュサーバは、アクセスしてきたユーザを分流し、ロードバランサーの役割を果たす一方、アクセスしてきたユーザの一番近い地理的位置からコンテンツを提供できる利点がある。
キャッシュサーバと呼ばれるのは、これらのサーバが保管するデータは、コンテンツの原本ではなく、キャッシュであるため、そのキャッシュを原本との一致性を保つため、TTLが設定されている。
また、キャッシュサーバでは動的キャッシュ(Dyanamic Cache)と静的キャッシュ(Static Cache)の違いがある、静的キャッシュは、その内容がユーザの入力等によって変化しないコンテンツ（ロゴや、固定の情報など）、ユーザの入力や、時間などの変量によって変化するコンテンツは動的キャッシュと呼ばれる。静的キャッシュが比較的に長めにTTL設定されているのに対して、動的キャッシュは短めにTTLが設定されており、そしてキャッシュサーバは基本のHTML構造や、部品をキャッシュし、変量を埋め込むような形でキャッシュすることがある。

# 2.
![[Pasted image 20250213200242.png]]
![[Pasted image 20250213200533.png]]
DDoS:
前問のキャッシュサーバの特徴にもあるように、キャッシュサーバはロードバランサーとしての効果もあるので、ロードバランサーが効果的に対処できる攻撃手法としては、大量のアクセスで宛先をサービス応答不能状態に追い込む、DDoS攻撃が考えられる。

# 3.
![[Pasted image 20250213215320.png]]
![[Pasted image 20250213215346.png]]
![[Pasted image 20250213215407.png]]
![[Pasted image 20250213215420.png]]
Host:
この問題を解説するには、まず問題のマルウェアの攻撃手法について知っておく必要がある。問題のマルウェアの攻撃手法は[[ドメインフロティング攻撃]]と呼ばれ、TLS接続時に提示したドメインと接続後送信するリクエストのドメインとの一致性が検証されないという脆弱性を利用して、悪意のあるサイトに接続してしまう攻撃を達成できている。
具体的な流れとしては、まずマルウェアが外部の悪意サイトに接続しようとして、TLSの接続を確立しようとする。この時点では[[TLS Handshake]]のClient HelloメッセージのExtensions-SNIへダーに、接続しようとするサイトのFQDNが記載されているが、Virtual Hostingや、問題のようにCDNに一回名前解決して接続するなどの場合では、一つの同じIPアドレスに複数の異なるURLが存在する。
そしてFWなどからみると、TLS接続の監視できる部分（TLS Helloで交わした暗号化されていないメッセージ）に記載されているFQDNが怪しいものではなく（むしろ場合によっては信頼できるFQDN)、この場合はFWが接続を許可する。
TLS接続確立後、実際マルウェアが送信するHTTP Requestのヘッダーの中では、本当に接続したい悪意サイトのFQDNが記載されている、そのFQDNを記載するヘッダーはHostになる。
現在ではCDNに、TLSのSNIとHostの不一致脆弱性を対策する方法があるが、適切に対策されていない場合では、クライアントとTLS接続を確立したCDNがクライアントからのリクエストを受け、リクエスト中のHostヘッダーにあるFQDNにパケットを転送してしまう。
# 4.
![[Pasted image 20250214123446.png]]
![[Pasted image 20250214123512.png]]
![[Pasted image 20250214123622.png]]
Y-CDN-U-FQDNの名前解決の結果と同じIPアドレスになるWebサイト：
まずは、問題の`Y-CDN-U-FQDN`について見ていく、このFQDNは問題中のY社がCDNにホストしているサイトに付与されたFQDNで、このFQDNを名前解決した結果では、クライアントに合わせて（地理的、コンテンツ適合上）適切なedgeサーバ（キャッシュサーバ）のIPアドレスが返される。
なので、この状況は複数のFQDNが同じIPアドレスを共有していると考えられるので、そのアドレスを封じ込んだ場合ではすべてこのアドレスを使用するFQDNに対してもアクセスできなくなる。

