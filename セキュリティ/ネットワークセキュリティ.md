### ファイアウォール
インターネットなどのリモートネットワークと社内LANなどのローカルネットワークの境界線に設置し、不正なデータ通行を阻止するものをファイアウォールという。

ファイアウォールはフィルタリングルールという規則に基づいてパケットの通過と不通過を決める。
フィルタリングはパケットのIPアドレスやポート番号などを検査するパケットフィルターと、アプリケーション層の内容まで検査するアプリケーションゲートウェイ方式がある。
- パケットフィルタリング：事前に定めたルールに基づく**スタティックパケットフィルタリング**と前後通信の文脈など流動的な情報を検査する**ダイナミックパケットフィルタリング**がある。（パケットの通信と応答を照合し、TCPの管理するシーケンス番号などで順番を確認し、パケットの妥当性を確認する）
- **パケットフィルタリング**は、通過するパケットの==IPアドレス(送信元・送信先)やポート番号、通信の方向などの情報==をもとに中継の可否を判断する方式です。ただし、==パケットのペイロード(データ部分)に関してはチェックを行いません==。

フィルタリングはルールベースの上からの順番で順次適用し、ルール内の一つでも適合すれば残りのルールは無効になる。

ルールの設定漏れを防ぐには、通過許可以外のパケットを全部禁止する、原則拒否方針がある。

アプリケーションゲートウェイ方式では、アプリケーション層レベルでコネクションを中継するため、HTTP，FTP，SMTPなどアプリケーション==プログラムごとに別々の中継プログラム==を用意する必要があります。

HTTP向けのものは特にプロキシサーバと呼ぶことがある。
### プロキシサーバ
クライアントからのリクエストを代理（中継）し、WEBサーバに送信する、フォワードプロキシとも呼ばれる。
プロキシサーバはWEBサーバからリクエストした内容を、サーバのキャッシュに保存しておき、次回クライアントから同じリクエストが来たときはWEBサーバにリクエストすることなくキャッシュの内容をクライアントに返信することができる。

WEBからアクセスされることのある、DMZに設置されるWEBサーバをLANに移設し、代わりにDMZにそのWEBサーバに中継するプロキシサーバを設置することで、WEBから直接サーバへのアクセスを防ぐことができ、このようなプロキシサーバをリバースプロキシサーバと呼ばれる。

#### プロキシサーバからのHTTP(S)リクエスト
プロキシサーバを利用したWebアクセスでは、クライアントはプロキシサーバに対してHTTP(S)リクエストを送り、プロキシサーバはクライアントから受け取ったHTTP(S)リクエストの内容（GETメソッドのURL）を使って外部の宛先サーバに代理アクセスします。

#### Webブラウザからのプロキシサーバ設定
プロキシを使用するにはWebブラウザに設定を行う必要があります。Webブラウザでは
**1.ホスト名、
2.FQDN名、
3.IPアドレス**
でプロキシサーバを指定できます。

[[WAF]]

#### DMZ
公開サーバなど外部からアクセスする可能性のある資源を持っている場合では、それらの資源をファイアウォールと並列し、ローカルネットワーク以外（ファイアウォールの外）に設置する。設置したエリアをDMZを呼ぶ。
WebサーバがDMZに設置されている場合は外部(インターネット上)の端末とWebサーバが直接コネクションを確立して通信を行います。しかしWebサーバを内部LANに移設した場合は、外部からのアクセスはHTTPアクセスは、一旦リバースプロキシサーバに渡され、リバースプロキシサーバが改めてWebサーバと通信を確立する形になります。  
リバースプロキシサーバを使用することでWebサーバの情報が外部から隠蔽されるため、Webサーバの内部へ不正アクセスを試みる攻撃へのセキュリティが強化されます。
### セキュリティ対策機器

#### 不正検出方法
- シクネチャ方式:シグネチャと呼ばれる攻撃パターンと通信パケットパターンベースを持ち、トラフィクに対してパターンマッチングによって不正のパケットを検出する。
- アノマリー方式：正常なパターンを定義し、それ以外の全てのパターンを禁止する方式。
いずれの方法も、正常なものを不正として認識してしまうFalse Postiveや、不正のものを正常として認識してしまうFalse Negativeという問題が起こり得る。

#### IDSと対策機器
IDS:Intrusion Detection System
- NIDS:ネットワーク型IDS。管理かのネットワークを監視し、不正なパケットや通信量が異常なときはそれをそれを検出し通知する
- HIDS:ホスト型IDS、ホストにインストールし、そのホストを監視する。パケット分析や、シグネチャとのパターンマッチングを失敗させるためのパケットが挿入された攻撃も検出できる。
- IPS:Intrusion Prevention System,不正パケットを検出だけではなく、検出の際通信を遮断するなどの対処も行う。
- ハニーポット：ダミーとして使われるサーバやネットワーク機器の総称、攻撃のログを取ることで、攻撃元の特定や対策に利用する。
- SIEM:Security Information and Event Management,ファイアウォールや IDS,IPSなどのネットワーク機器や、WEBサーバなど様々なサーバのログデータを一元に管理し、分析してセキュリティ上の脅威となる事象を発見し、通知するセキュリティシステム。

### **TPM**(Trusted Platform Module)
 PCのマザーボード上に直付けされるセキュリティチップで、暗号化と復号、鍵ペアの生成と管理、ハッシュ値の計算、乱数生成、デジタル署名の生成・検証などの機能を有します。  

鍵ペアの管理について、秘密鍵を生成した後、TPMの中に保管し、取り出せないようにしています。
その上、TPMの耐タンパ性から、TPMを取り外して分解しても秘密鍵を解読できない特徴がある
  
TPMによって提供されるセキュリティ機能には以下のようなものがあります。

- OSやアプリケーションの改ざん検知
- 端末認証
- プラットフォームの整合性の検証
- ストレージ全体の暗号化


### SMTPの転送脆弱性
**SMTP**(Simple Mail Transfer Protocol)を使用した一部のメールサーバソフトウェアは、誰からのメールでも受け付けるというの初期設定になっていました。さらにSMTPには、投稿者を認証する仕組みがないためにネットワーク外の第三者から別の第三者へのメールを無制限に受け付け中継してしまいます。  
このような第三者中継を禁止することで迷惑メールの発信者などの不正利用からメールサーバを防ぐことができます。

SMTPセキュリティ対策プロトコル：
![[アプリケーション層のプロトコル#^efbf44]]

![[アプリケーション層のプロトコル#^a6a550]]
### ルータとNAPTのセキュリティ効果
ブロードバンドルータは、家庭内の複数内の端末が同時にインターネットに接続できるように、**IPマスカレード**(NAPT)の機能を備えています。  
  
ブロードバンドルータは、LAN内のPCがインターネットに接続する際に、①PCのプライベートIPアドレスとポート番号の組合せをグローバルIPアドレスとポート番号の組合せに変換し、その対応を変換テーブルに記録しておきます。その後、インターネットから応答パケットを受け取ると、②変換テーブルの中から応答パケットの宛先ポート番号を探し、適切なプライベートIPアドレスとポート番号の組合せに戻して送信元PCに応答パケットを届けます。この一連のアドレスとポート番号の変更がIPマスカレードの動作です。   ^f90dcc
  
②の動作において該当するポート番号が変換テーブル内に存在しないときは、適切な変換先が見つからないのでルータは応答パケットを破棄することになります。つまり、外部から適当なパケットを送り付けても内部LANには到達しないということです。この仕組みにより、外部からポートスキャンや不正侵入を試みる攻撃が来たとしても、PCが守られるセキュリティ効果が期待できます。 ^85cea8

![[SPF]]
### DNSBL(DNS Blacklist)
迷惑メールの温床になっているオープンリレーサーバのIPアドレスや、スパム行為の発信元IPアドレスを一覧を公表したもの

### **LANアナライザ**
LAN上を通過するパケットを監視したり記録するためのハードウェアまたはソフトウェアのことです。LANアナライザが悪用されると盗聴などの被害をもたらす危険があるので慎重な管理が求められます。

![[CASB]]