### ファイアウォール
インターネットなどのリモートネットワークと社内LANなどのローカルネットワークの境界線に設置し、不正なデータ通行を阻止するものをファイアウォールという。

ファイアウォールはフィルタリングルールという規則に基づいてパケットの通過と不通過を決める。
フィルタリングはパケットのIPアドレスやポート番号などを検査するパケットフィルターと、アピりケーション層の内容まで検査するアプリケーションゲートウェイ方式がある。
- パケットフィルタリング：事前に定めたルールに基づく**スタティックパケットフィルタリング**と前後通信の文脈など流動的な情報を検査する**ダイナミックパケットフィルタリング**がある。（パケットの通信と応答を照合し、TCPの管理するシーケンス番号などで順番を確認し、パケットの妥当性を確認する）
- **パケットフィルタリング**は、通過するパケットの==IPアドレス(送信元・送信先)やポート番号、通信の方向などの情報==をもとに中継の可否を判断する方式です。ただし、==パケットのペイロード(データ部分)に関してはチェックを行いません==。

フィルタリングはルールベースの上からの順番で順次適用し、ルール内の一つでも適合すれば残りのルールは無効になる。

ルールの設定漏れを防ぐには、通過許可以外のパケットを全部禁止する、原則拒否方針がある。

アプリケーションゲートウェイ方式では、アプリケーション層レベルでコネクションを中継するため、HTTP，FTP，SMTPなどアプリケーション==プログラムごとに別々の中継プログラム==を用意する必要があります。

HTTP向けのものは特にプロキシサーバと呼ぶことがある。
### プロキシサーバ
クライアントからのリクエストを代理（中継）し、WEBサーバに送信する、フォワードプロキシとも呼ばれる。
プロキシサーバはWEBサーバからリクエストした内容を、サーバのキャッシュに保存しておき、次回クライアントから同じリクエストが来たときはWEBサーバにリクエストすることなくキャッシュの内容をクライアントに返信することができる。

WEBからアクセスされることのある、DMZに設置されるWEBサーバをLANに移設し、代わりにDMZにそのWEBサーバに中継するプロキシサーバを設置することで、WEBから直接サーバへのアクセスを防ぐことができ、このようなプロキシサーバをリバースプロキシサーバと呼ばれる。

### WAF
Web Application Firewall

通過するパケットのIPアドレスやポート番号だけでなくペイロード部(データ部分)をチェックすることで、Webアプリケーションに対する攻撃(SQLインジェクションなど)を検知し、攻撃と判断した通信をブロックするファイアウォールです。

WAFにより防御できるのは、Webアプリケーションだけです。Webアプリケーションとは、HTTP(S)通信の仕組みを使いWebブラウザとWebサーバのやり取りによって機能を提供するアプリケーション。

WAFはブラックリスト方式とホワイトリスト方式がある。

TLSの暗号と複合処理を専門的に計算するTLSを導入する場合は、WAFとファイアウォールの間に設置する。
インターネット->ファイアウォール->TLSアクセラレーター->WAF->WEBサーバ


#### DMZ
公開サーバなど外部からアクセスする可能性のある資源を持っている場合では、それらの資源をファイアウォールと並列し、ローカルネットワーク以外（ファイアウォールの外）に設置する。設置したエリアをDMZを呼ぶ。

### セキュリティ対策機器

#### 不正検出方法
- シクネチャ方式:シグネチャと呼ばれる攻撃パターンと通信パケットパターンベースを持ち、トラフィクに対してパターンマッチングによって不正のパケットを検出する。
- アノマリー方式：正常なパターンを定義し、それ以外の全てのパターンを禁止する方式。
いずれの方法も、正常なものを不正として認識してしまうFalse Postiveや、不正のものを正常として認識してしまうFalse Negativeという問題が起こり得る。

#### IDSと対策機器
IDS:Intrusion Detection System
- NIDS:ネットワーク型IDS。管理かのネットワークを監視し、不正なパケットや通信量が異常なときはそれをそれを検出し通知する
- HIDS:ホスト型IDS、ホストにインストールし、そのホストを監視する。パケット分析や、シグネチャとのパターンマッチングを失敗させるためのパケットが挿入された攻撃も検出できる。
- IPS:Intrusion Prevention System,不正パケットを検出だけではなく、検出の際通信を遮断するなどの対処も行う。
- ハニーポット：ダミーとして使われるサーバやネットワーク機器の総称、攻撃のログを取ることで、攻撃元の特定や対策に利用する。
- SIEM:Security Information and Event Management,ファイアウォールや IDS,IPSなどのネットワーク機器や、WEBサーバなど様々なサーバのログデータを一元に管理し、分析してセキュリティ上の脅威となる事象を発見し、通知するセキュリティシステム。

### **TPM**(Trusted Platform Module)
 PCのマザーボード上に直付けされるセキュリティチップで、暗号化と復号、鍵ペアの生成と管理、ハッシュ値の計算、乱数生成、デジタル署名の生成・検証などの機能を有します。  
  
TPMによって提供されるセキュリティ機能には以下のようなものがあります。

- OSやアプリケーションの改ざん検知
- 端末認証
- プラットフォームの整合性の検証
- ストレージ全体の暗号化


### SMTPの転送脆弱性
**SMTP**(Simple Mail Transfer Protocol)を使用した一部のメールサーバソフトウェアは、誰からのメールでも受け付けるというの初期設定になっていました。さらにSMTPには、投稿者を認証する仕組みがないためにネットワーク外の第三者から別の第三者へのメールを無制限に受け付け中継してしまいます。  
このような第三者中継を禁止することで迷惑メールの発信者などの不正利用からメールサーバを防ぐことができます。

SMTPセキュリティ対策プロトコル：
![[アプリケーション層のプロトコル#^efbf44]]

![[アプリケーション層のプロトコル#^a6a550]]
### ルータとNAPTのセキュリティ効果
ブロードバンドルータは、家庭内の複数内の端末が同時にインターネットに接続できるように、**IPマスカレード**(NAPT)の機能を備えています。  
  
ブロードバンドルータは、LAN内のPCがインターネットに接続する際に、①PCのプライベートIPアドレスとポート番号の組合せをグローバルIPアドレスとポート番号の組合せに変換し、その対応を変換テーブルに記録しておきます。その後、インターネットから応答パケットを受け取ると、②変換テーブルの中から応答パケットの宛先ポート番号を探し、適切なプライベートIPアドレスとポート番号の組合せに戻して送信元PCに応答パケットを届けます。この一連のアドレスとポート番号の変更がIPマスカレードの動作です。   ^f90dcc
  
②の動作において該当するポート番号が変換テーブル内に存在しないときは、適切な変換先が見つからないのでルータは応答パケットを破棄することになります。つまり、外部から適当なパケットを送り付けても内部LANには到達しないということです。この仕組みにより、外部からポートスキャンや不正侵入を試みる攻撃が来たとしても、PCが守られるセキュリティ効果が期待できます。 ^85cea8

### SPF
**SPF**(Sender Policy Framework)は、メールを送信しようとしてきたメールサーバの==IPアドレス情報を検証することで==、正規のサーバからのメール送信であるかどうか確認することができる技術です。受信メールサーバ側がメールの送信元==ドメイン==を管理するDNSサーバに問い合わせ、返された<u>IPアドレスが送信元メールサーバのIPアドレスと一致するか</u>どうかでなりすましを検知します。  
  
SPFでは以下の手順で送信元IPアドレスの検証を行います。

1. 送信側は、送信側ドメインのDNSサーバのSPFレコード(またはTXTレコード)に正当なメールサーバのIPアドレスやホスト名を登録し、公開しておく。
2. 送信側から受信側へ、SMTPメールが送信される。
3. 受信側メールサーバは、受信側ドメインのDNSサーバを通じて、MAIL FROMコマンドに記載された送信者メールアドレスのドメインを管理するDNSサーバに問い合わせ、SPF情報を取得する。
4. SPF情報との照合でSMTP接続してきたメールサーバのIPアドレスの確認に成功すれば、正当なドメインから送信されたと判断する。

### DNSBL(DNS Blacklist)
迷惑メールの温床になっているオープンリレーサーバのIPアドレスや、スパム行為の発信元IPアドレスを一覧を公表したもの

### **LANアナライザ**
LAN上を通過するパケットを監視したり記録するためのハードウェアまたはソフトウェアのことです。LANアナライザが悪用されると盗聴などの被害をもたらす危険があるので慎重な管理が求められます。