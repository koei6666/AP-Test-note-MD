生成されたタスクは以下の三つの状態がある、タスク管理ではこれら三つの状態を管理、制御することで複数のタスクを効率よく実行する。
タスクはCPUに使用権を割り当てられるのを待ち、実行できる状態にあり--実行可能状態
CPUに実行権を与えられ、タスク実行中--実行状態
入出力処理の完了、あるいは他タスクの完了合図を待ち--待ち状態

> [!休止状態] 
> 制御系の組み込みシステムで使用されるRTOS(Real-Time OS)は、リアルタイム性を実現するために、以上三つの状態の他に、休止状態が存在する。タスクは事前に生成され休止状態で待機し、起動システムコールによって呼び出され、実行可能状態に移る。

^096478


タスク間の状態遷移は以下のステップがある：
1. タスクの生成：生成されたタスクの実行可能状態の待ち行列に加われ、CPUが割り当てられるのを待つ
2. 実行可能状態==>実行状態：ディスパッチャ（CPUスケジューラ）によりCPUが割り当てられ、タスクは実行状態に移る。（ディスパッチ）
3. 実行状態==>実行可能状態：割り当てられたCPU時間が終了し、あるいは、より優先度の高いタスクが実行可能な状態になると、タスクが中断され、強制的に実行可能状態に移る。（プリエンプション）
4. 実行状態==>実行待ち状態：SVCによる入出力の要求を行い、その結果を待つ必要が生じた時、あるいはある事象によって待ち合わせの必要が生じた時、待ち状態に遷移、出力動作の完了を待ち、あるいは事象の発生を待つ。
5. 待ち状態==>実行可能状態：待ち原因となった現象が完了すると、実行可能状態になる。
6. タスクの消滅：タスクが実行完了すると、タスクように確保した資源は全て解放され、他のタスクが使えるようになる。

#### マルチプログラミング
実行中のタスクが入出力で待ち状態中の時、CPUは処理がなく負荷が空いているので、その時間を利用して他の処理をするマルチプログラミング制御ができる。

#### プリエンプション

^1627f1

実行中のタスクを中断させ、使用権を獲得する動作をプリエンプションと呼ぶ。
このプリエンプション方式ではOSがCPUを管理するため、強制的に実行中のタスクから優先度の高いタスクに切り替えさせることができる。[[割り込み制御]] ^71cdf8

一方、このような強制切り替え方式を使用しない方式はノンプリエンプション方式と呼ぶ。このような方式では、タスクが自らOSに制御権を戻す命令を発行するか、タスクが終了するまで切り替えできないの２パターンがある。 ^fc43ef

ノンプリエンプティブ・スケジューリングを使用する現実のシステムとして、航空制御システムや銀行の金融取引システムがあります。

1. **航空制御システム:** 飛行機の自動操縦システムでは、一度タスク（例えば、飛行機の速度や高度の調整）が開始されると、それが完全に終了するまで他のタスクに制御が移ることはありません。これは飛行の安全性を確保するために非常に重要であり、中断されることなくタスクが完了することを保証します。このような場合、ノンプリエンプティブ・スケジューリングが使用されます。
    
2. **銀行の金融取引システム:** 銀行の金融取引（預金、引き出し、送金など）では、一度取引が開始されると、それが完全に終了するまで他の取引に制御が移ることはありません。これは取引の整合性を確保し、重複取引や誤った取引を防ぐために重要です。また、このようなシステムでは、一度に一つの取引を処理することで、システム全体の信頼性と安全性を高めることができます。
