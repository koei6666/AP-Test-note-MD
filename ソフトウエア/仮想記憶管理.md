仮想記憶方式は、磁気ディスクなどの補助記憶装置の一部を主記憶の拡張として、主記憶の物理的な容量よりも大きなアドレス空間（仮想アドレス空間または論理アドレス空間と呼ぶ）を提供する方式。

現在実行中のプログラムで使う部分を主記憶に、優先度の低い部分を補助記憶装置（仮想記憶）に退避させ、プログラムの実行に合わせて主記憶と仮想記憶の間でデータの入れ替えを行うことで、主記憶の実容量で扱えるよりも大きな、または多くのプログラムを同時に展開できるようにしています。

仮想記憶方式では、プログラムに渡したアドレスは仮想アドレスのため、実行する前には主記憶上に存在する実アドレスに変換しなければいけない、その変換は動的アドレス変換(DAT:Dynamic Address Translator)という。そして実際この変換を実行する装置はMMU(Memory Management Unit)である。

> [!Info] MMU
> MMU(Memory Management Unit，メモリ管理機構)は、主記憶を管理するためのハードウェア機構で、アドレス変換機能やメモリ保護機能、キャッシュ制御機能、及びバス調停機能などを持っています。

^a0c79c

仮想記憶を実現する方式は、大きく分けて以下の二つがある：
　- [[ページング方式]]:仮想記憶の代表的な方式であるページング方式は、主記憶をページという固定長のブロックで分割、仮想記憶も同じようにページ単位に分割してページ単位で管理します。補助記憶には主記憶で使われることを待っているページが格納されていて、あるページがプログラムから要求されると、補助記憶から主記憶にはそのページが移されます。逆に主記憶から追い出されたページは補助記憶上に格納されています。

　- セグメント方式:プログラムをセグメントという可変長の論理的単位に分割し、セグメント単位でアドレス変換を行う。また、ページング方式と組み合わせたセグメンテーションページング方式もある。
　  例えば、仮想アドレスが100で、セグメントの基底アドレスが200、サイズが300の場合を考えてみましょう。ここで仮想アドレス100は制限300内にあるので、基底アドレス200にオフセット100を加えると、物理アドレスは300となります。
　  **ページングとセグメンテーションの組み合わせ**では、まず仮想アドレスをセグメントに分解し、その後、それぞれのセグメントをさらにページに分解します。この方式を使用すると、セグメンテーションの柔軟性とページングの簡便さを組み合わせることができます。

仮想記憶アドレスと実アドレスの変換は：
1. 仮想アドレスから、ページテーブル内の対象ページの先頭アドレスを得る
2. ページテーブルのページ情報に設定されているフラグ(ページフォールトビット)を見て、対象ページが主記憶に存在しているかを知る
3. ページフォールトであればページアウト・ページイン処理を行う
4. ページテーブルから対象ページの主記憶上の位置を取得し、それに仮想アドレスのページ内変位を加えて求める主記憶上のアドレスを得る

### スラッシング
(Thrashing)
仮想記憶では、プログラムの多重度が高く、各プログラムへの割り当てした主記憶容量が小さかったり、適切なページング方式が取らなかったりすると、ページングの優先度はプログラム実行より高いため、CPUがページングを優先に、プログラムに時間を割り当てず、スループットが急激に低下する現象をスラッシングと呼ぶ。




