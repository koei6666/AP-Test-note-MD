### ICMP
### ICMP（Internet Control Message Protocol）

#### 主なポイント
1. **エラー報告と診断**: ICMPは、IPレベルでのエラー報告や診断のためのプロトコルです。
2. **制御メッセージの送信**: ICMPは制御メッセージを用いて、ネットワークの健全性や接続性を確認します。

#### 構成特徴
- **ヘッダとデータ部分**: ICMPメッセージは、基本的にはヘッダとデータの2部分から構成されます。ヘッダは通常8バイトであり、データ部分は可変長です。

#### 用途
- **ネットワークの診断**: `ping`コマンドのように、ネットワーク接続の可用性を確認する。
- **エラー通知**: ルータやホストが、特定の問題（例えば、宛先への到達不能）に遭遇したときに通知する。

### 主なICMPメッセージの例

1. **Echo Request / Echo Reply**: これは`ping`コマンドで最もよく使用されるメッセージタイプです。Echo Requestを送信すると、目的地がEcho Replyで応答します。
  
2. **Destination Unreachable**: このメッセージは、パケットが目的地に到達できないときに送信されます。例えば、宛先ホストがネットワークに存在しない場合など。DBMSなどの異常終了による障害は検出できない。到達できない以外の異常イベントを検出するには、[[アプリケーション層のプロトコル#SNMP|SNMP Trap]]を使う。
  
3. **Time Exceeded**: このメッセージは、パケットのTTL（Time to Live）が0になった場合、またはフラグメンテーションに時間がかかりすぎた場合に送信されます。
  
4. **Redirect**: このメッセージは、ホストに対してより効率的なルートが存在する場合に、ルータからホストに送信されます。

#### 実世界の例

- **ネットワークトラブルシューティング**: システム管理者は`ping`や`traceroute`コマンドを使用して、ネットワークの問題を診断する際にICMPメッセージが用いられます。
  
- **ネットワーク監視**: 一部のネットワーク監視ツールは、ICMP Echo RequestとEcho Replyメッセージを用いて、ネットワークデバイスのアップタイムを確認します。

ICMPは、IPネットワークの診断、エラー報告、制御を行う非常に重要なプロトコルです。しかし、セキュリティ上の理由から、一部のネットワークではICMPメッセージの種類や方向を制限することがあります。

#### **ICMPリダイレクト**
**ICMPリダイレクト**は、L3SWやルータが特定のネットワーク宛てのパケットに関してよりよい経路情報を送信元に伝達するために使用されるメッセージです。
送信先が故障などによってOSPFを稼働させ、経路を変更しパケット転送している場合では、送信元にICMPリダイレクトパケットを発信し、転送不要の送信先への変更を提案する。
ICMPリダイレクトパケットを受信した送信元はそれを解釈し、次の送信から新送信先に送るように変更する。
