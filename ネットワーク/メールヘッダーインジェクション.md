IPv6（Internet Protocol version 6）は、IPv4の後継となるインターネットプロトコルです。IPv6は、インターネットの急速な成長とともに発生したIPv4アドレスの枯渇問題を解決するために設計されました。

#### 主なポイント
1. **拡張されたアドレス空間**: IPv6はv4の32bitから128ビットのアドレスを使用するため、膨大な数のIPアドレスを割り当てることが可能です。
2. **簡素化されたヘッダ**: IPv6は、ルーティング効率とパフォーマンス向上を目的としてヘッダを簡素化し、固定長化しています。
3. **セキュリティ**: IPsecというセキュリティプロトコルが標準で組み込まれています。
4. **自動設定**: IPv6には、アドレスの自動設定機能（SLAAC, DHCPv6など）があります。
5. **モビリティとマルチキャスト**: IPv6は、モバイルデバイスやマルチキャスト通信に対するサポートが強化されています。特製グループのうち経路上最も近いノード、あるいは最適なノードにデータを送信するエニーキャストを追加。



#### アドレスの例
IPv4のアドレスは通常、10進数のドット区切り形式（例: 192.168.1.1）で表されます。一方で、IPv6アドレスは128ビットであり、16進数とコロン（:）を用いた形式（例: 2001:0db8:85a3:0000:0000:8a2e:0370:7334）で表されます。

各ブロックの先頭から続く0は、1つを残し、以降は省略可能:
2001:0db8:85a3:0:0:8a2e:0370:7334

0のブロックが続く場合、一箇所に限り、::に省略することが可能。
2001:0db8:85a3::8a2e:0370:7334

### プレフィックス
IPv6ではサブネットマスクはなく、プレフィックス記法でネットワークとホストを区別する。
例えば:　`2001:db8:100:1000::/56`は56bitまでネットワークアドレスで、それ以降はホストアドレスと表す。

#### 実世界の例

- **スマートデバイス**: IoT（Internet of Things）の普及により、多くのスマートデバイスがインターネットに接続するようになりました。IPv6の広いアドレス空間は、これらのデバイス全てにユニークなアドレスを提供できます。
  
- **企業ネットワーク**: IPv6を採用することで、企業は内部ネットワークでNAT（Network Address Translation）を使用する必要がなくなり、エンドツーエンドの通信が容易になります。

- **インターネットバックボーン**: ルーティング効率の向上とアドレスの簡単な管理のために、多くのインターネットバックボーンプロバイダーがIPv6を導入しています。


### ユニキャストアドレス（Unicast Address）

#### 主なポイント
1. **一対一の通信**: ユニキャストアドレスは、特定のネットワーク上の一つの宛先（デバイスやインターフェース）にパケットを送るためのアドレスです。
2. **IPアドレスの基本形**: これが最も一般的に使用されるIPアドレスのタイプです。

#### 構成特徴
- IPv4：通常、10進数のドット区切り形式（例: 192.168.1.1）
- IPv6：16進数とコロンを用いた形式（例: 2001:0db8:85a3:0000:0000:8a2e:0370:7334）

#### 用途
- **一般的なインターネット通信**: ウェブサーフィン、メール送信、ファイル転送など。

### エニーキャストアドレス（Anycast Address）

#### 主なポイント
1. **最も近い宛先への通信**: 同じエニーキャストアドレスを持つ複数のデバイスが存在する場合、送信元から最も近い（通常はホップ数または遅延で測定）デバイスにパケットがルーティングされます。
2. **冗長性と負荷分散**: エニーキャストは自然な冗長性と負荷分散機構を提供します。

#### 構成特徴
- エニーキャストアドレスは、通常、既存のユニキャストアドレス範囲から割り当てられます。

#### 用途
- **DNSサーバ**: 世界中に分散したDNSサーバが同じエニーキャストアドレスを使用することで、ユーザーは最も近いDNSサーバに接続します。
  
### マルチキャストアドレス（Multicast Address）

#### 主なポイント
1. **一対多の通信**: マルチキャストアドレスを使用すると、一つの送信元から複数の宛先に同時にパケットを送ることができます。
2. **帯域幅の効率的な使用**: 同じデータを多数の宛先に送る必要がある場合、マルチキャストは帯域幅を節約する効果があります。

#### 構成特徴
- IPv4：特定の範囲（224.0.0.0 から 239.255.255.255）のIPアドレスがマルチキャストに使用されます。
- IPv6：IPv6では、`FF00::/8` のプレフィックスを持つアドレスがマルチキャストに割り当てられます。

#### 用途
- **ビデオ・オーディオストリーミング**: 同じコンテンツを多数のユーザーに配信する場合。
- **ネットワーク管理**: SNMP（Simple Network Management Protocol）などのプロトコルで使用されます。

これらのアドレスタイプは、それぞれ特有の用途と構造を持っており、ネットワークの効率性、スケーラビリティ、柔軟性を高めるために使用されます。


### IPv6ヘッダ
IPv6のヘッダは、IPv4のヘッダよりも設計が簡素化されており、固定長の40バイトです。この簡素な設計により、ルータやスイッチはパケットの処理が高速化され、ネットワークのパフォーマンスが向上します。

#### IPv6ヘッダの主要なフィールド

1. **バージョン (Version)**: このフィールドは4ビットであり、プロトコルのバージョンを示します。IPv6の場合、このフィールドの値は常に`6`です。
  
2. **トラフィッククラス (Traffic Class)**: この8ビットのフィールドは、パケットがどのように扱われるべきかを示します。このフィールドは、QoS（Quality of Service）に影響を与えます。
  
3. **フローレーベル (Flow Label)**: この20ビットのフィールドは、同じ「フロー」に属するパケットを識別します。フローとは、同じソースと宛先間での一連のパケットです。
  
4. **ペイロード長 (Payload Length)**: この16ビットのフィールドは、オプションのIPv6拡張ヘッダと後続のデータ部分（ペイロード）の合計長を示します。
  
5. **次ヘッダ (Next Header)**: この8ビットのフィールドは、ペイロードのタイプを示します。例えば、TCPやUDPなどのトランスポート層のプロトコルを指します。また、このフィールドはIPv6拡張ヘッダも指す場合があります。
  
6. **ホップリミット (Hop Limit)**: この8ビットのフィールドは、パケットが通過できるルータの最大数を示します。この値が0になると、パケットは破棄されます。
  
7. **ソースアドレスと宛先アドレス**: それぞれ128ビットのアドレスで、パケットの送信元と宛先を示します。

#### 実世界の例

- **ルーティングデバイス**: ルータやスイッチは、IPv6ヘッダの簡素な設計により、高速なパケット転送が可能です。
  
- **エンドツーエンド通信**: `Hop Limit`と`Next Header`のようなフィールドは、エンドツーエンドの通信品質とセキュリティを強化します。

**注意**: IPv6は、必要に応じて「拡張ヘッダ」を使用できます。これは、オプションの情報（セキュリティ、ルーティングオプションなど）を提供するためのもので、基本ヘッダの後に続きます。しかし、これはオプションであり、基本の40バイトのヘッダだけでも十分なケースが多いです。

IPv6のヘッダ設計は、高速なパケット処理と効率的なルーティングを目的としています。この設計により、IPv6はスケーラビリティとパフォーマンスの面で優れた特性を持っています。


### NATとNAPT
#### NAT（Network Address Translation）

##### 主なポイント
1. **アドレス変換**: NATは、プライベートIPアドレスとパブリックIPアドレスの間でアドレスを変換する技術です。
2. **1対1または1対多のマッピング**: 一つのプライベートIPアドレスは一つのパブリックIPアドレスにマップされる場合もあり、また複数のプライベートIPアドレスが一つのパブリックIPアドレスにマップされる場合もあります。

##### 構成特徴
- **静的NAT**: 事前に設定されたプライベートIPとパブリックIPの対応関係に基づいて変換を行います。
- **動的NAT**: アドレス変換テーブルに基づいて、動的にプライベートIPとパブリックIPがマッピングされます。

##### 用途
- **プライベートネットワークの隠蔽**: 内部ネットワークの構造やアドレスを外部に公開しないで、インターネットにアクセスする。

##### 実世界の例
- **ホームルータ**: 多くの家庭では、複数のデバイスが1つのパブリックIPアドレスを共有してインターネットに接続します。これがNATによって可能になっています。

#### NAPT（Network Address Port Translation）

**NAPT**(Network Address Port Translation)は、プライベートIPアドレスとグローバルIPアドレスを1対1で相互変換するNATの考え方に、ポート番号でのクライアント識別を組み合わせた技術です。ホストごとにユニークなポート番号を割り当てるので1つのグローバルIPアドレスで複数のプライベートIPアドレスを持つノードを同時にインターネット接続させることが可能です。IPマスカレードとも呼ばれます。  
  
パケットを内部から外部に中継する場合は、パケットの発信元プライベートアドレスをルータ(またはファイアウォール)自身のグローバルアドレスに変換するとともに発信元ポート番号に任意のあいているポートを割り当てます。逆に外部から内部に応答パケットを中継する場合は、宛先アドレス＆ポート番号に発信時に保存しておいたプライベートアドレスとポート番号を設定し内部のノードにパケットを通します。

![[ネットワークセキュリティ#^f90dcc]]
![[ネットワークセキュリティ#^85cea8]]
##### 主なポイント
1. **アドレスとポートの変換**: NAPTは、NATと同様にIPアドレスを変換するだけでなく、トランスポート層のポート番号も変換します。
2. **多対一のマッピング**: 複数のプライベートIPアドレス（とポート）が、一つのパブリックIPアドレス（と異なるポート）にマッピングされることが多い。

##### 構成特徴
- NAPTは、同じパブリックIPアドレスを使用しながら、異なる内部デバイスからの接続を区別するためにポート番号を使用します。

##### 用途
- **帯域幅とアドレスの効率的な利用**: 一つのパブリックIPアドレスを多くのユーザーで共有でき、IPアドレスの枯渇問題を緩和します。
- **セキュリティ上の効果**:内部ネットワーク上に存在するホストのアドレスを外部に対して隠蔽できる

##### 実世界の例
- **企業ネットワーク**: 社内の多数のデバイスが、1つまたは数つのパブリックIPアドレスを通して外部と通信する場合、NAPTがよく使用されます。

### NATとNAPTの違い

- **NATはアドレスのみを変換**しますが、**NAPTはアドレスとポート番号の両方を変換**します。
- NATは主に1対1のマッピングを行いますが、NAPTは多対一のマッピングが一般的です。

これらの技術は、プライベートネットワークが安全にかつ効率的にインターネットリソースにアクセスできるように設計されています。特にIPv4アドレスが不足している現在、NATとNAPTは非常に重要な役割を果たしています。

### ICMP
### ICMP（Internet Control Message Protocol）

#### 主なポイント
1. **エラー報告と診断**: ICMPは、IPレベルでのエラー報告や診断のためのプロトコルです。
2. **制御メッセージの送信**: ICMPは制御メッセージを用いて、ネットワークの健全性や接続性を確認します。

#### 構成特徴
- **ヘッダとデータ部分**: ICMPメッセージは、基本的にはヘッダとデータの2部分から構成されます。ヘッダは通常8バイトであり、データ部分は可変長です。

#### 用途
- **ネットワークの診断**: `ping`コマンドのように、ネットワーク接続の可用性を確認する。
- **エラー通知**: ルータやホストが、特定の問題（例えば、宛先への到達不能）に遭遇したときに通知する。

### 主なICMPメッセージの例

1. **Echo Request / Echo Reply**: これは`ping`コマンドで最もよく使用されるメッセージタイプです。Echo Requestを送信すると、目的地がEcho Replyで応答します。
  
2. **Destination Unreachable**: このメッセージは、パケットが目的地に到達できないときに送信されます。例えば、宛先ホストがネットワークに存在しない場合など。DBMSなどの異常終了による障害は検出できない。到達できない以外の異常イベントを検出するには、[[アプリケーション層のプロトコル#SNMP|SNMP Trap]]を使う。
  
3. **Time Exceeded**: このメッセージは、パケットのTTL（Time to Live）が0になった場合、またはフラグメンテーションに時間がかかりすぎた場合に送信されます。
  
4. **Redirect**: このメッセージは、ホストに対してより効率的なルートが存在する場合に、ルータからホストに送信されます。

#### 実世界の例

- **ネットワークトラブルシューティング**: システム管理者は`ping`や`traceroute`コマンドを使用して、ネットワークの問題を診断する際にICMPメッセージが用いられます。
  
- **ネットワーク監視**: 一部のネットワーク監視ツールは、ICMP Echo RequestとEcho Replyメッセージを用いて、ネットワークデバイスのアップタイムを確認します。

ICMPは、IPネットワークの診断、エラー報告、制御を行う非常に重要なプロトコルです。しかし、セキュリティ上の理由から、一部のネットワークではICMPメッセージの種類や方向を制限することがあります。

#### **ICMPリダイレクト**
**ICMPリダイレクト**は、L3SWやルータが特定のネットワーク宛てのパケットに関してよりよい経路情報を送信元に伝達するために使用されるメッセージです。
送信先が故障などによってOSPFを稼働させ、経路を変更しパケット転送している場合では、送信元にICMPリダイレクトパケットを発信し、転送不要の送信先への変更を提案する。
ICMPリダイレクトパケットを受信した送信元はそれを解釈し、次の送信から新送信先に送るように変更する。

[[IPSec]]

---
- ESP (Encapsulating Security Payload)
AHと同様にIPsecプロトコルを構成する技術の一つで、IPパケットの送信元の認証やパケットが改ざんされていないか確認して、暗号化を行います。