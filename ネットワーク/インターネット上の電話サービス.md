インターネット上で電話サービスを行うには、音声転送技術と呼び制御技術の二つが必要になる。
これらを行う技術はVoIP,とSIPがある

### VoIP
Voice over Internet Protocol
IPネットワークで音声をやりとりするための技術である。
データを転送するためには、UDPを元とした、リアルタイム性に優れたRTP(Real-Time Transport Protocol)が使われる。
一般の電話機にIPアダプタを付加することで、VoIP対応する機器にすることができる。構築したIP電話網を従来の音声回線と接続するにはVoIPゲートウェイを使う。

VoIPゲートウェイは電話のアナログ信号をデジタル信号に符号化したり、複合する装置である。

**VoIP**(Voice over IP：ボイップ)は、音声データをIPネットワークで伝送する技術です。アナログ音声を各種符号化方式でデジタル化し、IPネットワーク上のパケットに乗せることで音声データのリアルタイム伝送を行います。  
  
VoIPの構成要素であるPBX、VoIPゲートウェイ、VoIPゲートキーパ、ルータの機能は次のとおりです。

**PBX（Private Branch eXchange）**

複数の構内電話機を、公衆電話回線網に接続して使用する際の中継装置のこと。

**VoIPゲートウェイ**

電話網とIPネットワークの境界に置かれ、音声とIPパケットの相互変換を行う。

**VoIPゲートキーパ**

IPアドレスと内線電話番号対応を管理し変換を行う。

**ルータ**

他のIPネットワークとの境界に設置され、パケットのIPアドレスを見て最適な経路に中継する通信装置。

![[Pasted image 20230907205903.png]]
### SIP
SIP（Session Initiation Protocol）は、インターネット上で音声、ビデオ、テキストなどのリアルタイムなコミュニケーションを可能にするプロトコルです。このプロトコルは、インターネット電話サービス（VoIP、Voice over Internet Protocol）に広く利用されています。

#### SIPの主な機能
1. **セッションの確立**: SIPは、通話の開始（セッションの確立）と終了（セッションの解放）を制御します。
2. **参加者の探索と位置情報の取得**: SIPは、特定のユーザーがどこに存在するか（IPアドレスなど）を発見する手段を提供します。
3. **呼び出しの転送と取得**: 一度確立された通話を別のエンドポイントに転送する機能もあります。

#### SIPの動作
1. **インビテーション（INVITE）**: SIPクライアント（例えば、VoIP電話やスマートフォンのアプリ）が通話を開始するために、SIPサーバーに対してINVITEリクエストを送ります。
2. **レスポンス（200 OKなど）**: 相手側のSIPクライアントがリクエストを受け入れた場合、200 OKといったSIPレスポンスを返します。
3. **ACK**: このレスポンスを受け取った後、最初のSIPクライアントはACKリクエストを送って通話を確立します。

**実世界の例**: Skype、Zoom、CiscoのWebExなどのVoIPサービスは、裏側でSIPや類似のプロトコルを使用しています。

#### SIPのアーキテクチャ
SIPは以下のようなコンポーネントで構成されています。
1. **SIPクライアント**: 通話の開始や受け入れを行うエンドポイント（例：VoIP電話、スマートフォンアプリ）。
2. **SIPサーバー**: SIPリクエストを処理し、クライアント間の通信を制御する。種類には以下のものがあります。
   - **レジストラーサーバー**: クライアントの位置情報を登録。
   - **プロキーサーバー**: SIPリクエストを適切なエンドポイントにルーティング。
   - **リダイレクトサーバー**: クライアントにリダイレクト先を通知。
   
#### セキュリティ
- **SIP over TLS**: SIP通信を暗号化するためにTLS（Transport Layer Security）が使用されることがあります。
- **SRTP (Secure Real-time Transport Protocol)**: 実際の音声やビデオデータの暗号化には、SRTPが使用される場合があります。

このように、SIPはインターネット上でリアルタイムコミュニケーションを行うための非常に柔軟かつ強力なプロトコルです。